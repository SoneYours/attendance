<include target="_header.html" />
<load target="js/at.js" />
<load target="filter/insert_attendance.xml" />
<load target="filter/fix_attendance_data.xml" />


{@$year=substr($selected_date,0,4)}
{@$month=substr($selected_date,4,2)}
{@$day=substr($selected_date,6,2)}
{@$week=$oAttendanceModel->getWeek($selected_date)}
<script type="text/javascript">
    var warn_msg = '{$lang->attend_warn}';
</script>


<div class="navi">
	<a href="#" onclick="toggle_object('calendar'); return false;" >
		<strong class="att-btn att-btn-primary">{$year}{$lang->yyear} {$month}{$lang->mmo} {$day}{$lang->dday}</strong>
	</a>
	<block cond="$lgi->is_admin=='Y'">
		<span style="margin-left:20px;">
			<a href="{getUrl('module','','mid','attendance','document','','act','dispAttendanceAdminBoardConfig')}" class="att-btn att-btn-primary">{$lang->cmd_setup}</a> 
			<a href="{getUrl('module','','mid','attendance','document','','act','dispAttendanceAdminBoardSkinConfig')}" class="att-btn att-btn-primary"> {$lang->skin} {$lang->cmd_setup}</a> 
			<a href="{getUrl('module','admin','act','dispAttendanceAdminList','mid','')}" onclick="window.open(this.href);return false;" alt="{$lang->attendance_module}{$lang->cmd_management}" class="att-btn att-btn-primary">{$lang->cmd_management}</a>
		</span>
	</block>
	<block cond="$is_logged">
		<span style="float:right;">
			<a href="{getUrl('document_srl','','selected_date',zDate(date('YmdHis',mktime(0,0,0,$month-1, $day, $year)),'Ymd'))}" class="att-btn att-btn-primary">이전달</a>
			<a href="{getUrl('document_srl','','selected_date',zDate(date('YmdHis'),"Ymd"))}" class="att-btn att-btn-primary">{$year}년 {$month}월</a>
			<a href="{getUrl('document_srl','','selected_date',zDate(date('YmdHis',mktime(0,0,0,$month+1, $day, $year)),'Ymd'))}" class="att-btn att-btn-primary">다음달 </a>
		</span>
	</block>
</div><!-- .navi -->



<!--//지금 출석하시면 받을 수 있는 포인트 목록-->
    <div class="point_list_body">
    
    <table width="100%" border="0" cellpadding="0" cellspacing="0" border="0" class="point_list">
    	<tr>
        	<td class="title">{$lang->attendance_add_point}</td>
            <td><!--@if($cd->add_point > 0)-->{$cd->add_point}<!--@elseif($cd->add_point == 0)--> {$lang->attend_none}<!--@end--></td>
            <td class="title">{$lang->attendance_perfect} {$lang->point}</Td>
            <td>
			<ul class="point-ul">
				<li  class="pointlist-item"><span class="pointlist-text">자세히보기</span>
					<ul class="pointlist-wrap">
						<li class="pointlist-subitem">
						<span class="pointlist-sub-text1">{$lang->attendance_yearly_point}</span> :<span class="pointlist-sub-text2"><!--@if($cd->yearly_point > 0)-->{$cd->yearly_point}<!--@elseif($cd->yearly_point == 0)--> {$lang->attend_none}<!--@end--></span>
						</li>
						<li class="pointlist-subitem">
						<span class="pointlist-sub-text1">{$lang->attendance_monthly_point}</span> :<span class="pointlist-sub-text2"><!--@if($cd->monthly_point > 0)-->{$cd->monthly_point}<!--@elseif($cd->monthly_point == 0)--> {$lang->attend_none}<!--@end--></span>
						</li>
						<li class="pointlist-subitem">
						<span class="pointlist-sub-text1">{$lang->attendance_weekly_point}</span> :<span class="pointlist-sub-text2"><!--@if($cd->weekly_point > 0)-->{$cd->weekly_point}<!--@elseif($cd->weekly_point == 0)--> {$lang->attend_none}<!--@end--></span>
						</li>

					</ul>
				</li>

			</ul>
			</td>
            <td class="title">랭킹 점수</td>
            <td>
			<ul class="point-ul">
				<li  class="pointlist-item"><span class="pointlist-text">자세히보기</span>
					<ul class="pointlist-wrap">
						<li class="att-caret-block">
							<span class="att-caret-outer"></span>
							<span class="att-caret-inner"></span>
						</li>
						<li class="pointlist-subitem">
						<span class="pointlist-sub-text1">{$lang->attendance_first_point}</span> :<span class="pointlist-sub-text2"><!--@if($cd->first_point > 0)-->{$cd->first_point}<!--@elseif($cd->first_point == 0)--> {$lang->attend_none}<!--@end--></span>
						</li>
						<li class="pointlist-subitem">
						<span class="pointlist-sub-text1">{$lang->attendance_second_point}</span> :<span class="pointlist-sub-text2"><!--@if($cd->second_point > 0)-->{$cd->second_point}<!--@elseif($cd->second_point == 0)--> {$lang->attend_none}<!--@end--></span>
						</li>
						<li class="pointlist-subitem">
						<span class="pointlist-sub-text1">{$lang->attendance_third_point}</span> :<span class="pointlist-sub-text2"><!--@if($cd->third_point > 0)-->{$cd->third_point}<!--@elseif($cd->third_point == 0)--> {$lang->attend_none}<!--@end--></span>
						</li>

					</ul>
				</li>

			</ul>
			</td>
            <td class="title">출석 권한</td>
            <td><span class="label label-success" cond="$mi->pomis">{$mi->pomis}</span><span class="label label-success" cond="!$mi->pomis">로그인 사용자</span></td>

        </tr>
        
        <tr>
            <td class="title">출석시간</td>
            <td><span class="<!--@if($is_available == 0)-->label label-success <!--@else-->label label-danger<!--@end-->"><!--@if($mi->timestart)-->{$mi->timestart}<!--@else-->00:00:00<!--@end-->~<!--@if($mi->timeend)-->{$mi->timeend}<!--@else-->24:00:00<!--@end--></span></td>
            <td class="title">진행상태</td>
            <td><!--@if($is_available == 0)--><span class="label label-success">출석가능</span><!--@else--><span class="label label-warning">불가능</span><!--@end--></td>
            <td class="title">출석여부</td>
            <td><!--@if(!$is_logged)--><span class="label label-danger">비로그인</span><!--@elseif($oAttendanceModel->getIsChecked($logged_info->member_srl)==0)--><span class="label label-warning">출책안함</span><!--@elseif($oAttendanceModel->getIsChecked($logged_info->member_srl)==1)--> <span class="label label-success">출책완료</span><!--@end--></td>
            <td class="title">{$lang->attendance_perfect} {$lang->category}</td>
            <td><span class="per">{$lang->week}</span> <span class="perm">{$lang->mmo}</span> <span class="pery">{$lang->yyear}</span></td>

        </tr>
        
    </table>

    </div><!-- .point_list_body -->
    
	

<!--@if($mi->calendar != 'Y')-->
<div id="calendar" style="display:none">
	<include target="calendar.html" />
</div>
<!--@else-->
<div id="calendar" style="display:block">
	<include target="calendar.html" />
</div>
<!--@end-->

 
           <!--//도장버튼 노출-->

    
    <div class="cal">
    
		<!--@if(!$oAttendanceModel->getIsChecked($logged_info->member_srl) == 0 && $is_available == 0 )-->
			

			<div class="sat" style="margin:10px 1px" cond="$is_logged">
				<div class="alert alert-success">
					<h4>{$lgi->nick_name} 님은</a><block cond="$mi->logo_image"><img style="margin-bottom:-10px;" src="{$mi->logo_image}" />에서</block> 출석이 완료되었습니다.</h4>
					출석은 하루 1회만 참여하실 수 있습니다. 내일 다시 출석해 주세요.^^
				</div>	
			</div>

			<div class="sat" style="margin:10px 1px" cond="!$is_logged">
				<div class="alert alert-danger">
					<h4>현재 로그인이 되지 않은 상태입니다.</h4>
					로그인을 하신다음 출책이 가능합니다.
				</div>	
			</div>
		<!--@end-->
 
	    <!--//출석을 하지 않았고, 출석 가능한 시간대라면-->
	    <!--@if($oAttendanceModel->getIsChecked($logged_info->member_srl) == 0 && $is_available == 0 )-->
			<!--@if($config->about_admin_check!='no')-->

			<div class="sat" style="margin:10px 1px" cond="$is_logged">
				<div class="alert alert-warning">출석도장 찍으세요</div>
            

                <div class="x">
	                <form action="{getUrl('')}" method="post" id="click_button" onsubmit="return attendance_check()" name="f1" style="text-align:center" >                   

                    <span class="x_input-append" style="width:100%; display:inline-block">
                   
						<input type="text" onclick="this.value='';" name="greetings" id="greetings" class="iText" onkeypress="return text_entercheck(event); " maxlength="<!--@if(!$mi->maxlength)-->30<!--@end--> {$mi->maxlength}" onfocus="alll()" style="width:500px;" />
						<input type="hidden" name="about_position" value="yes" />
                        
                        <a class="x_btn x_disabled">(<input type="Textbox" class="cout" name= "t2" style="background:transparent; font-size:14px; width:20px; text-align:right; margin:0; padding:0; height:20px; border:none;">  /  <!--@if(!$mi->maxlength)-->30<!--@end--> {$mi->maxlength} )
                        </a>
					<button type="button" class="x_btn x_btn-inverse" onclick="if(f1.greetings.value){return attendance_check()}else{return attendance_no_check()}">출석 도장!</button>
					</span>
	                </form>
                </div>
			</div>

			<div class="sat" style="margin:10px 1px" cond="!$is_logged">
				<div class="alert alert-danger">
					<h4>현재 로그인이 되지 않은 상태입니다.</h4>
					로그인을 하신다음 출책이 가능합니다.
				</div>	
			</div>
			<!--@else-->
			<!--@if($logged_info->is_admin != 'Y')-->
			<div class="sat" style="margin:10px 1px" cond="$is_logged">
				<div class="alert">출석도장 찍으세요</div>
            

                <div class="x">
	                <form action="{getUrl('')}" method="post" id="click_button" onsubmit="return attendance_check()" name="f1" style="text-align:center" >                   

                    <span class="x_input-append" style="width:100%; display:inline-block">
                   
						<input type="text" onclick="this.value='';" name="greetings" id="greetings" class="iText" onkeypress="return text_entercheck(event); " maxlength="<!--@if(!$mi->maxlength)-->30<!--@end--> {$mi->maxlength}" onfocus="alll()" style="width:500px;" />
						<input type="hidden" name="about_position" value="yes" />
                        
                        <a class="x_btn x_disabled">(<input type="Textbox" class="cout" name= "t2" style="background:transparent; font-size:14px; width:20px; text-align:right; margin:0; padding:0; height:20px; border:none;">  /  <!--@if(!$mi->maxlength)-->30<!--@end--> {$mi->maxlength} )
                        </a>
					<button type="button" class="x_btn x_btn-inverse" onclick="if(f1.greetings.value){return attendance_check()}else{return attendance_no_check()}">출석 도장!</button>
					</span>
	                </form>
                </div>
			</div>
			<!--@end-->
			<div class="sat" style="margin:10px 1px" cond="$logged_info->is_admin == 'Y'">
				<div class="alert alert-admin"><h4>{$lang->attend_banned_admin}</h4></div>	
			</div>
			<div class="sat" style="margin:10px 1px" cond="!$is_logged">
				<div class="alert alert-danger">
					<h4>현재 로그인이 되지 않은 상태입니다.</h4>
					로그인을 하신다음 출책이 가능합니다.
				</div>	
			</div>			
			<!--@end-->
	    <!--@end-->
        </div>




  		
  
    <!--//등수변수 초기화-->
    <!--@if($mi->order_type=='desc')-->
        {@$position=($mi->start_num)-($mi->list_count*($oAttendance->page-1))}
    <!--@else-->
        {@$position=1+($oAttendance->page-1)*$mi->list_count}
    <!--@end-->

    
    <!--@if($oAttendanceAdminModel->getTodayTotalCount($selected_date)==0)-->
			
				<div class="alert alert-danger">
					<h4>{$lang->attend_no_checked}</h4>
					출석좀~ 해 쭈_쎄요~ (쭈_쎄요~)
				</div>

		
    <!--@else-->
    
    <!--//출석한 사람이 있다면 반복문 시작-->
    <!--//쿼리를 통해 받은 사용자정보를 순서대로 얻어오는 구문-->

            <table cellspacing="0" class="table at_board_title">
			
            <thead>
        <tr align="center" >
            <th scope="col" class="no">{$lang->position}</th>
            <th scope="col"><span>{$lang->time}</span></th>
            <th scope="col" class="title"><span>{$lang->greetings}</span></th>
            <th scope="col" class="nick"><span>{$lang->nick_name}</span></th>
			<th scope="col"><span>{$lang->point}</span></th>
			<th scope="col" cond="$cd->about_random == 'yes'"><span>랜덤 {$lang->point}</span></th>
			<th scope="col"><span>{$lang->attendance_perfect}</span></th>
			<th scope="col"><span>{$lang->view_total_day}</span></th>
            <!--@if($mi->display_ip_address != 'N')-->
            <th scope="col"><span>{$lang->ipaddress}</span></th>
            <!--@end-->
        </tr>
        
        </thead>

    <!--@foreach($oAttendance->data as $data)-->
        {@$is_perfect=$oAttendanceModel->isPerfect($data->member_srl, $selected_date)}
        {@$weekly = $oAttendanceModel->getWeeklyData($data->member_srl, $week)}
            {@$member = $oMemberModel->getMemberInfoByMemberSrl($data->member_srl)}
            <!--@if(ereg("^#[0-9]+$",$data->greetings))-->
                {@$length_greetings = strlen($data->greetings) -1}
                {@$oDocument = $oDocumentModel->getDocument(substr($data->greetings,1,$length_greetings))}
                <!--@if($oDocument->document_srl)-->
                    {@$exist_document = 1}
                <!--@else-->
                    {@$exist_document = 0}
                <!--@end-->
            <!--@else-->
                {@$exist_document = 0}
            <!--@end-->
            
                    
            <tbody>
            <tr <!--@if($member->member_srl == $logged_info->member_srl)-->class="infome"<!--@end-->>
                <td class="no" style="text-align:center;">
                <!--@if($position == 1)-->
                <img src="./css/rank1.png" />
                 <!--@elseif($position == 2)-->
                 <img src="./css/rank2.png" />
                 <!--@elseif($position == 3)-->
                 <img src="./css/rank3.png" />
                 <!--@else-->
                 {$position}
                 <!--@end-->
                </td>
                
                <td class="time" style="text-align:center;">

                {substr($data->regdate,8,2).":".substr($data->regdate,10,2).":".substr($data->regdate,12,2)}
                </td>
                
                <td class="title" align="left">
                

            
                
                    <!--@if($data->greetings)-->
                        <!--@if($exist_document == 1)-->
							{$oDocument->getContentText(text)}
                        <!--@else-->
                            {@$greetings_filtering = str_replace('<','&lt;',$data->greetings)}
                            <!--@if($data->greetings!='^admin_checked^' && $data->greetings!='^auto^')-->{cut_str($greetings_filtering, $mi->greetings_cut_size, '...')}
                            <!--@elseif($data->greetings=='^admin_checked^')-->{$lang->attendance_admin_checked}
                            <!--@elseif($data->greetings=='^auto^')-->{$lang->attend_auto_check}
                            <!--@else-->{$lang->default_greetings}
                            <!--@end-->
                        <!--@end-->
                    <!--@else-->
                        {$lang->attend_no_greetings}
                    <!--@end-->
                    
                    
                    
                </td>
                <td align="left" class="author">
                <span>
				<img class="lulu-thumb-sosiimg avatar-icons" src="{$member->profile_image->file}" cond="$member->profile_image->file && $mi->profileimg=='Y'" />
				<img class="lulu-thumb-sosiimg avatar-icons" src="{$mi->no_profile}" cond="!$member->profile_image->file && $mi->no_profile  && $mi->profileimg=='Y'" />
				<img class="lulu-thumb-sosiimg avatar-icons" src="./img/noprofile.gif" cond="!$member->profile_image->file && !$mi->no_profile  && $mi->profileimg=='Y'" />
				<a href="#popup_menu_area" class="member_{$member->member_srl}" onclick="return false">
					{$member->nick_name}
				</a></span>
				
                </td>
 
      
                
                <td class="pointlister" style="text-align:center" align="center">
                
                <!--@if($logged_info->is_admin=="Y" && $grant->manager == 1)-->
                <a href="{getUrl('act','dispAttendanceAdminModifyAttendance','mid','attendance','attendance_srl',$data->attendance_srl,'selected_date',$selected_date)}">
                
                <!--@if($data->today_point > 5)-->
                <font color="#FF0000">
                {$data->today_point}</font>
                <!--@else-->
                {$data->today_point}
                <!--@end-->
               
                </a>
                
                <!--@else-->
                
                <!--@if($data->today_point > 5)-->
                <font color="#FF0000">
                {$data->today_point}</font>
                <!--@else-->
                {$data->today_point}
                <!--@end-->
                
                <!--@end-->
                
                </td>

				<td class="randomdata" cond="$cd->about_random == 'yes'"><block cond="$data->today_random=='0'">꽝</block><block cond="$data->today_random>='1'">{$data->today_random}</block></td>

                <td class="intrambo" style="text-align:center" align="center">
                <!--@if($is_perfect->yearly_perfect)-->
				<span class="pery">{$lang->attendance_perfect}</span>
                <!--@elseif($is_perfect->monthly_perfect == 1)-->
				<span class="perm">{$lang->attendance_perfect}</span>
				<!--@elseif($weekly->weekly == 7 && $selected_date == $week->sunday1)-->
				<span class="per">{$lang->attendance_perfect}</span>
				<!--@else-->
				{@
					$oAttendanceModel = &getModel('attendance');
					$total_info = $oAttendanceModel->getTotalData($member->member_srl);
				}
				{$total_info->continuity}일째
				<!--@end-->
				</td>
				<td class="intrambos" style="text-align:center" align="center">
				{number_format($oAttendanceModel->getTotalAttendance($member->member_srl))}일
				</td>


                
                <!--@if($mi->display_ip_address != 'N')-->
                <td class="ip" style="text-align:left;">
                    <!--@if($data->ipaddress == 'none')-->
                        {$data->ipaddress}
                    <!--@elseif(!$data->ipaddress)-->
                        {$lang->attend_warn_ip}
                    <!--@else-->
                        <!--@if($data->member_srl == $logged_info->member_srl || $logged_info->is_admin =='Y')-->
                            {$data->ipaddress}
                        <!--@else-->
                            {@$ip_tmp = explode('.',$data->ipaddress)}
                            {@$i=0}<!--@foreach($ip_tmp as $ip)--><!--@if($i==0 || $i==1)-->{@$i++}*.<!--@elseif($i==2)-->{@$i++}{$ip}.<!--@else-->{@$i++}{$ip}<!--@end--><!--@end-->
                        <!--@end-->
                    <!--@end-->
                </td>
                <!--@end-->
       
            </tr>
            </tbody>  
    		<!--@if($mi->order_type=='desc')-->{@$position--}<!--@else-->{@$position++}<!--@end-->
    <!--@end-->
            </table>
            
	<!--@end-->
	
    <!--@if(!$oAttendanceAdminModel->getTodayTotalCount($selected_date)==0)-->

     <div style="position:relative; width:100%; padding:5px 0; text-align:center">       
            <!--//페이지 내비게이션-->
			<ul class="pagination">
       		<li><a href="{getUrl('page',$oAttendance->page_navigation->first_page,'module_srl','')}"  class="direction prev">&lsaquo; {$lang->first_page}</a></li>
	    <!--@while($page_no = $oAttendance->page_navigation->getNextPage())-->
		    <!--@if($oAttendance->page == $page_no)-->
			    <li><a>{$page_no}</a></li>
		    <!--@else-->
			    <li><a href="{getUrl('page',$page_no,'module_srl','')}">{$page_no}</a></li>
		    <!--@end-->
	    <!--@end-->
		<li><a href="{getUrl('page',$oAttendance->page_navigation->last_page,'module_srl','')}"  class="direction next">{$lang->last_page} &rsaquo;</a></li>
    </ul>
	</div>
	<!--@end-->
    

            
    
    
    <p></p>


<!--#include("_footer.html")-->
